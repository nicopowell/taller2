<!-- 
    ================================================================================
    VISTA: LISTADO DE PRESUPUESTOS (Index.cshtml)
    ================================================================================
    CONCEPTO TEÓRICO: Vistas Razor & Lógica de Negocio en Entidades (TP 8)
    
    1. model IEnumerable<...>: 
       Define que esta vista recibe una COLECCIÓN de presupuestos.
       'IEnumerable' es la interfaz base para listas, arrays, etc.
       Usamos el Modelo de Dominio directo porque es solo lectura.
-->
@model IEnumerable<MVC.Models.Presupuesto>

@{
  ViewData["Title"] = "Listado de Presupuestos";
}

<h2 class="mt-4">Listado de Presupuestos</h2>

<p>
  <!-- Botón para ir al formulario de creación -->
  <a asp-action="Create" class="btn btn-success">Crear Nuevo Presupuesto</a>
</p>

<table class="table">
  <thead>
    <tr>
      <!-- 
                Html.DisplayNameFor(...):
                Este Helper es muy útil. No muestra el valor, sino el NOMBRE del campo.
                Si en la clase 'Presupuesto' usaste [Display(Name="Fecha de Creación")],
                eso es lo que se mostrará aquí. Si cambias el modelo, la vista se actualiza sola.
            -->
      <th>@Html.DisplayNameFor(model => model.IdPresupuesto)</th>
      <th>@Html.DisplayNameFor(model => model.NombreDestinatario)</th>
      <th>@Html.DisplayNameFor(model => model.FechaCreacion)</th>
      <th>Monto Total (c/IVA)</th> <!-- Columna calculada -->
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <!-- Iteramos sobre la colección de presupuestos -->
    @foreach (var item in Model)
    {
      <tr>
        @* Html.DisplayFor(...):
          Renderiza el valor de la propiedad. Es inteligente con los tipos de datos
          (ej: formata fechas automáticamente según la cultura del servidor). *@
        <td>@Html.DisplayFor(modelItem => item.IdPresupuesto)</td>
        <td>@Html.DisplayFor(modelItem => item.NombreDestinatario)</td>
        <td>@Html.DisplayFor(modelItem => item.FechaCreacion)</td>

        @* LÓGICA DE NEGOCIO EN LA VISTA:
          Aquí llamamos al método 'MontoPresupuestoConIva()' que definimos 
          dentro de la clase 'Presupuesto'. 
          Esto demuestra el principio de encapsulamiento: la entidad sabe calcular su total.
          .ToString("N2"): Formato numérico con 2 decimales. *@
        <td>$ @item.MontoPresupuestoConIva().ToString("N2")</td>

        <td>
          @* Botones de acción pasando el ID de la fila actual *@
          <a asp-action="Edit" asp-route-id="@item.IdPresupuesto">Editar</a> |
          <a asp-action="Details" asp-route-id="@item.IdPresupuesto">Detalles</a> |
          <a asp-action="Delete" asp-route-id="@item.IdPresupuesto">Eliminar</a>
        </td>
      </tr>
    }
  </tbody>
</table>